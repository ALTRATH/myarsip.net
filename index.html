<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALTRADEV - Arsip Inject Kuota</title>
    <style>
    /* ========== VARIABLES & RESET ========== */
    :root {
        --primary-color: #00ffff;
        --secondary-color: #ff00ff;
        --bg-dark: #0a0a0a;
        --bg-medium: #1a1a2e;
        --bg-light: #16213e;
        --text-color: #fff;
        --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* ========== BODY & TYPOGRAPHY ========== */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 50%, var(--bg-light) 100%);
        color: var(--text-color);
        overflow-x: hidden;
        transition: var(--transition);
        line-height: 1.6;
    }

    /* ========== NAVIGATION ========== */
    nav {
        position: fixed; top: 0; width: 100%;
        background: rgba(0,0,0,0.95);
        backdrop-filter: blur(20px);
        z-index: 1000;
        padding: 1rem 2rem;
        box-shadow: 0 4px 30px rgba(0, 255, 255, 0.1);
        display: flex; justify-content: space-between; align-items: center;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: bold;
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .logo:hover {
        text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        transform: scale(1.05);
    }

    /* ========== MENU & DROPDOWN ========== */
    .menu-toggle {
        display: flex;
        background: rgba(0, 255, 255, 0.1);
        border: 1px solid var(--primary-color);
        border-radius: 25px;
        padding: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 4px 15px rgba(0, 255, 255, 0.2);
        position: relative;
    }

    .menu-toggle:hover {
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
        transform: scale(1.05);
    }

    .hamburger {
        display: flex; flex-direction: column; gap: 4px;
    }

    .hamburger span {
        width: 25px; height: 3px;
        background: var(--text-color);
        border-radius: 2px;
        transition: all 0.3s ease;
    }

    .menu-toggle.active .hamburger span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
    .menu-toggle.active .hamburger span:nth-child(2) { opacity: 0; }
    .menu-toggle.active .hamburger span:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }

    .dropdown {
        display: none;
        position: absolute; top: 100%; right: 0;
        background: rgba(0,0,0,0.95);
        border: 1px solid var(--primary-color);
        border-radius: 15px;
        padding: 1rem;
        margin-top: 0.5rem;
        box-shadow: 0 8px 32px rgba(0, 255, 255, 0.2);
        min-width: 200px;
        z-index: 1001;
    }

    .dropdown.active { display: block; }

    .dropdown .nav-btn {
        display: block;
        width: 100%;
        text-align: left;
        padding: 0.8rem 1rem;
        border: none;
        background: transparent;
        color: var(--text-color);
        cursor: pointer;
        border-radius: 10px;
        transition: var(--transition);
        position: relative; overflow: hidden;
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    .dropdown .nav-btn:last-child { margin-bottom: 0; }

    .dropdown .nav-btn::before {
        content: '';
        position: absolute; top: 50%; left: 50%;
        width: 0; height: 0;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .dropdown .nav-btn:active::before {
        width: 200px; height: 200px;
    }

    .dropdown .nav-btn:hover, .dropdown .nav-btn.active {
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        color: #000;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
        transform: scale(1.02);
    }

    /* ========== NEW LOADING SPINNER CSS ========== */
    .loading {
        display: none;
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 5px solid rgba(0, 255, 255, 0.3);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* ========== SEARCH INPUT CSS BARU ========== */
    .search-container {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
    }
    
    .search-input {
        width: 100%;
        max-width: 600px;
        padding: 0.8rem 1.5rem;
        border: 2px solid var(--primary-color);
        background: var(--bg-medium);
        color: var(--text-color);
        border-radius: 30px;
        font-size: 1rem;
        transition: box-shadow 0.3s, border-color 0.3s;
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
    }


    /* ========== PAGES & CONTENT ========== */
    .page {
        display: none;
        min-height: 100vh;
        padding: 8rem 2rem 2rem;
        opacity: 0;
        transform: translateY(30px);
        transition: var(--transition);
    }

    .page.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }

    h1 {
        text-align: center;
        margin-bottom: 1rem; /* Kurangi margin karena ada search box */
        font-size: 3rem;
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }

    .subjudul {
        margin: 2rem 0 0.5rem; 
        font-size: 1.8rem;
        color: var(--primary-color);
        border-bottom: 2px solid rgba(0, 255, 255, 0.3);
        padding-bottom: 0.5rem;
        position: relative;
    }

    .subjudul::after {
        content: '';
        position: absolute; bottom: -2px; left: 0;
        width: 0; height: 2px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        transition: width 0.3s ease;
    }

    .subjudul:hover::after { width: 100%; }

    /* ========== EDITABLE BOXES ========== */
    .editable-box {
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 15px;
        padding: 1.5rem;
        margin: 1rem 0;
        box-shadow: 0 8px 32px rgba(0, 255, 255, 0.1);
        transition: var(--transition);
        cursor: default;
        position: relative;
        overflow: hidden;
        user-select: none;
    }

    .editable-box.editable {
        cursor: text;
        user-select: text;
    }

    .editable-box::before {
        content: '';
        position: absolute; top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
        transition: left 0.5s;
    }

    .editable-box:hover::before { left: 100%; }

    .editable-box:hover {
        box-shadow: 0 12px 40px rgba(0, 255, 255, 0.3);
        transform: translateY(-5px) scale(1.02);
        border-color: var(--primary-color);
    }

    .editable-box.locked {
        cursor: not-allowed;
    }

    .editable-box.locked:hover { 
        transform: none; 
        box-shadow: 0 8px 32px rgba(0, 255, 255, 0.1);
    }
    
    /* Lock Icon */
    .lock-icon {
        position: absolute; top: 10px; right: 10px;
        font-size: 1.2rem;
        color: var(--secondary-color);
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
    }

    .lock-icon:hover {
        color: var(--text-color);
        transform: rotate(180deg) scale(1.2);
    }
    
    .list-item {
        list-style: none;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        transition: all 0.3s ease;
        /* Tambahkan kursor agar terlihat bisa di-klik */
        cursor: copy; 
        /* Ganti font untuk terlihat lebih 'kode' dan seragam */
        font-family: 'Consolas', 'Courier New', monospace; 
        font-size: 0.95rem;
        white-space: pre-wrap; /* Pastikan teks panjang tetap bisa di-wrap */
    }
    
    .list-item:last-child {
        border-bottom: none;
    }

    .list-item:hover { color: var(--primary-color); }

    .add-btn {
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        color: #000;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 25px;
        cursor: pointer;
        margin: 1rem 0;
        font-weight: bold;
        transition: var(--transition);
        box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
    }

    .add-btn:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 255, 255, 0.5);
    }

    ul {
        list-style: none;
        padding: 0;
    }

    /* Kontrol Aksi Box (Delete & Reset) */
    .box-actions {
        position: absolute;
        top: 10px;
        left: 15px;
        display: flex;
        gap: 10px;
        z-index: 10;
        opacity: 0; 
        transition: opacity 0.3s;
    }
    
    .action-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: var(--text-color);
        padding: 4px 8px;
        border-radius: 5px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s;
    }

    .action-btn:hover {
        transform: scale(1.05);
    }

    .action-btn.delete:hover { background: rgba(255, 0, 0, 0.5); border-color: red; }

    /* Pastikan tombol aksi terlihat saat hover pada kotak */
    .editable-box:hover .box-actions {
        opacity: 1 !important; 
    }

    /* Override opacity saat box dikunci. Tombol aksi tetap disembunyikan jika dikunci. */
    .editable-box.locked:hover .box-actions {
        opacity: 0 !important;
    }
    /* Pastikan tombol aksi terlihat hanya jika unlocked */
    .editable-box.editable .box-actions {
        opacity: 1 !important;
    }


    /* ========== PARTICLE BACKGROUND ========== */
    .particles {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: -1;
    }

    .particle {
        position: absolute;
        background: radial-gradient(circle, rgba(0,255,255,0.2), transparent);
        border-radius: 50%;
        animation: float 15s infinite linear;
    }

    @keyframes float {
        0% { transform: translateY(100vh) rotate(0deg) scale(0); opacity: 0; }
        10% { opacity: 1; transform: scale(1); }
        90% { opacity: 1; }
        100% { transform: translateY(-100px) rotate(360deg) scale(1.5); opacity: 0; }
    }

    /* ========== MODAL STYLES ========== */
    .modal {
        display: none;
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 2000;
        justify-content: center; align-items: center;
    }

    .modal-content {
        background: #111;
        padding: 2rem;
        border-radius: 15px;
        border: 1px solid var(--primary-color);
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 255, 255, 0.2);
    }

    .modal input {
        padding: 0.8rem;
        border: 1px solid var(--primary-color);
        background: #000;
        color: var(--text-color);
        border-radius: 5px;
        margin: 1rem 0;
    }

    .modal button {
        padding: 0.8rem 1.5rem;
        background: var(--primary-color);
        color: #000;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 0 0.5rem;
    }

    .modal button:hover { background: var(--secondary-color); }

    /* ========== RESPONSIVE DESIGN ========== */
    @media (max-width: 768px) {
        nav { padding: 1rem; }
        .logo { font-size: 1.5rem; }
        .page { padding: 6rem 1rem 1rem; }
        h1 { font-size: 2.2rem; }
        .subjudul { font-size: 1.5rem; }
        .dropdown { min-width: 180px; }
        .search-input { padding: 0.6rem 1rem; font-size: 0.9rem; }
    }
</style>
</head>
<body>
    <div class="particles" id="particles"></div>

<div class="loading" id="loading">
    <div class="loading-spinner"></div>
</div>

<nav>
    <div class="logo" onclick="app.toggleAllLocks()">ALTRADEV</div>
    <div class="menu-toggle" id="menuToggle">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="dropdown" id="dropdown">
            <button class="nav-btn active" data-page="1">Metode Inject</button>
            <button class="nav-btn" data-page="2">Arsip Bug</button>
            <button class="nav-btn" data-page="3">Akun SSH/V2Ray</button>
        </div>
    </div>
</nav>

<div class="modal" id="passwordModal">
    <div class="modal-content">
        <h2>Masukkan Password</h2>
        <input type="password" id="pwInput" placeholder="Password...">
        <br>
        <button onclick="app.checkPassword()">Buka</button>
        <button onclick="app.closeModal()">Batal</button>
    </div>
</div>

<section class="page active" id="page1">
    <h1>Metode Inject</h1>
    <div class="search-container">
        <input type="text" class="search-input" id="search-page1" placeholder="Cari di Metode Inject...">
    </div>
    <button class="add-btn" onclick="app.addBox('page1')">+ Tambah Kotak</button>

    <div id="boxes-page1">
        </div>
</section>

<section class="page" id="page2">
    <h1>Arsip Bug</h1>
    <div class="search-container">
        <input type="text" class="search-input" id="search-page2" placeholder="Cari di Arsip Bug...">
    </div>
    <button class="add-btn" onclick="app.addBox('page2')">+ Tambah Kotak</button>
    <div id="boxes-page2">
        </div>
</section>

<section class="page" id="page3">
    <h1>Akun SSH/V2Ray</h1>
    <div class="search-container">
        <input type="text" class="search-input" id="search-page3" placeholder="Cari di Akun SSH/V2Ray...">
    </div>
    <button class="add-btn" onclick="app.addBox('page3')">+ Tambah Kotak</button>
    <div id="boxes-page3">
        </div>
</section>

<script>
    // ALTRADEV App - Main Application Object
    const app = {
        isUnlocked: localStorage.getItem('isUnlocked') === 'true', 
        CORRECT_PASSWORD: 'altranet', 
        // defaultBoxContents & deletedKeys DIHAPUS karena tidak ada lagi kotak bawaan

        // ========== INITIALIZATION ==========
        init: function() {
            // Karena tidak ada kotak bawaan, fungsi ini sekarang hanya memuat kotak dinamis.
            this.filterInitialBoxes(); // Kosong
            this.loadData();
            this.ensureBoxActionsExist();
            this.setupEventListeners();
            this.createParticles();
            this.updateLockState(this.isUnlocked);
            this.setupSearch();
        },
        
        filterInitialBoxes: function() {
            // Kosong, karena tidak ada kotak bawaan hardcoded
        },
        
        ensureBoxActionsExist: function() {
            document.querySelectorAll('.editable-box').forEach(box => {
                const lockIcon = box.querySelector('.lock-icon');
                let actionContainer = box.querySelector('.box-actions');

                if (actionContainer) actionContainer.remove();

                actionContainer = document.createElement('div');
                actionContainer.className = 'box-actions';
                
                actionContainer.innerHTML = `
                   <button class="action-btn delete" onclick="app.deleteBox(this)">üóëÔ∏è Hapus</button>
                `;
                
                if (lockIcon) {
                    lockIcon.after(actionContainer);
                } else {
                    box.prepend(actionContainer);
                }
                
                actionContainer.style.opacity = this.isUnlocked ? 1 : 0; 
            });
        },


        // ========== EVENT HANDLERS & NAVIGATION ==========
        setupEventListeners: function() {
            const menuToggle = document.getElementById('menuToggle');
            const dropdown = document.getElementById('dropdown');

            const closeDropdown = () => {
                if (menuToggle && dropdown) {
                    menuToggle.classList.remove('active');
                    dropdown.classList.remove('active');
                }
            };

            document.addEventListener('keydown', e => {
                const box = e.target.closest('.editable-box');
                const isEditableChild = e.target.closest('[data-editable-child="true"]');
                if (box && !this.isUnlocked && (box.contentEditable === 'false' || isEditableChild)) {
                    e.preventDefault();
                    this.showModal(); 
                }
            });

            document.addEventListener('beforeinput', e => {
                 const box = e.target.closest('.editable-box');
                 const isEditableChild = e.target.closest('[data-editable-child="true"]');
                 if (box && !this.isUnlocked && (box.contentEditable === 'false' || isEditableChild)) {
                    e.preventDefault();
                    this.showModal();
                }
            });

            document.addEventListener('input', e => {
                const box = e.target.closest('.editable-box');
                if (box && box.dataset.key && this.isUnlocked) { 
                    this.saveBoxContent(box.dataset.key, box.innerHTML);
                }
            });
            
            document.addEventListener('click', e => {
                const listItem = e.target.closest('.list-item');
                const subjudul = e.target.closest('.subjudul');
                
                if (listItem || subjudul) {
                    if (!this.isUnlocked) {
                         const textToCopy = (listItem || subjudul).textContent.trim();
                         this.copyText(textToCopy);
                    }
                }
            });


            if (menuToggle && dropdown) {
                menuToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menuToggle.classList.toggle('active');
                    dropdown.classList.toggle('active');
                });

                document.addEventListener('click', (e) => {
                    if (!menuToggle.contains(e.target)) {
                        closeDropdown();
                    }
                });
            }

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const pageNum = btn.dataset.page;
                    if (pageNum) {
                        this.navigateToPage(pageNum);
                        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        closeDropdown();
                    }
                });
            });

            window.addEventListener('scroll', closeDropdown);
        },
        
        copyText: function(text) {
            if (!navigator.clipboard) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed'; 
                textarea.style.top = 0;
                textarea.style.left = 0;
                textarea.style.opacity = 0;
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('Teks disalin: ' + text);
                } catch (err) {
                    console.error('Gagal menyalin: ', err);
                    alert('Gagal menyalin teks. Silakan salin manual.');
                }
                document.body.removeChild(textarea);
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Teks disalin: ' + text);
            }).catch(err => {
                console.error('Gagal menyalin: ', err);
                alert('Gagal menyalin teks. Silakan salin manual.');
            });
        },
        
        // ========== FITUR SEARCH ==========
        setupSearch: function() {
            ['search-page1', 'search-page2', 'search-page3'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', (e) => {
                        const pageId = e.target.id.replace('search-', ''); 
                        this.filterBoxes(pageId, e.target.value);
                    });
                }
            });
        },
        
        filterBoxes: function(pageId, searchTerm) {
            const container = document.getElementById(`boxes-${pageId}`);
            if (!container) return;

            const boxes = container.querySelectorAll('.editable-box');
            const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

            boxes.forEach(box => {
                const boxText = box.textContent.toLowerCase();
                
                if (lowerCaseSearchTerm === '') {
                    box.style.display = 'block';
                } else if (boxText.includes(lowerCaseSearchTerm)) {
                    box.style.display = 'block';
                } else {
                    box.style.display = 'none';
                }
            });
        },


        // ========== NAVIGATION & LOADING BAR SPINNER ==========
        navigateToPage: function(pageNum) {
            const loading = document.getElementById('loading');
            if (!loading) return;

            loading.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            const searchInput = document.getElementById(`search-page${pageNum}`);
            if(searchInput) searchInput.value = '';
            
            this.filterBoxes(`page${pageNum}`, ''); 


            setTimeout(() => {
                loading.style.display = 'none';
                document.body.style.overflow = 'auto';

                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const targetPage = document.getElementById(`page${pageNum}`);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
            }, 500); 
        },

        // ========== UNLOCK SYSTEM ==========
        updateLockState: function(unlocked) {
            this.isUnlocked = unlocked;
            localStorage.setItem('isUnlocked', String(unlocked));

            document.querySelectorAll('.editable-box').forEach(box => {
                const lockIcon = box.querySelector('.lock-icon');
                const actionBox = box.querySelector('.box-actions');
                
                const isDynamicBox = true; // Sekarang semua kotak adalah dinamis
                
                box.classList.toggle('locked', !unlocked);
                box.classList.toggle('editable', unlocked);
                
                box.contentEditable = String(unlocked && isDynamicBox); 
                
                box.querySelectorAll('[data-editable-child="true"]').forEach(child => {
                    if (unlocked) {
                       child.setAttribute('contenteditable', 'true');
                    } else {
                       child.removeAttribute('contenteditable');
                    }
                });

                if (lockIcon) lockIcon.textContent = unlocked ? 'üîì' : 'üîí';
                
                if (actionBox) actionBox.style.opacity = unlocked ? 1 : 0;
            });
        },

        // ========== DATA MANAGEMENT ==========
        loadData: function() {
            this.loadAndRenderDynamicBoxes('page1'); 
            this.loadAndRenderDynamicBoxes('page2');
            this.loadAndRenderDynamicBoxes('page3');
        },
        
        loadAndRenderDynamicBoxes: function(page) {
            const container = document.getElementById(`boxes-${page}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            const dynamicBoxes = JSON.parse(localStorage.getItem(`${page}-boxes`) || '[]');
            
            dynamicBoxes.forEach(boxData => {
                 this.renderSingleBox(container, boxData.key, boxData.content);
            });
        },
        
        saveBoxContent: function(key, content) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            
            tempDiv.querySelector('.box-actions')?.remove();
            tempDiv.querySelector('.lock-icon')?.remove();
            
             tempDiv.querySelectorAll('[data-editable-child="true"]').forEach(child => {
                 child.removeAttribute('contenteditable');
             });
             
            const cleanedContent = tempDiv.innerHTML;

            const pageMatch = key.match(/^(page\d+)-box-/);
            if (pageMatch) {
                const page = pageMatch[1]; 
                const boxes = JSON.parse(localStorage.getItem(`${page}-boxes`) || '[]');
                const index = boxes.findIndex(box => box.key === key);

                if (index !== -1) {
                    boxes[index].content = cleanedContent; 
                } else {
                     boxes.push({ key: key, content: cleanedContent }); 
                }
                localStorage.setItem(`${page}-boxes`, JSON.stringify(boxes));
            }
        },
        
        // ========== BOX MANAGEMENT ==========
        
        renderSingleBox: function(container, key, content, prepend = false) {
             const tempDiv = document.createElement('div');
             const isDynamicBox = true;
             const lockedClass = this.isUnlocked ? 'editable' : 'locked';
             const editable = String(this.isUnlocked && isDynamicBox); 
             
             tempDiv.className = `editable-box ${lockedClass}`;
             tempDiv.contentEditable = editable;
             tempDiv.dataset.key = key;
             
             tempDiv.innerHTML = content;
             
             const lockIconHTML = `<span class="lock-icon" onclick="app.toggleLock(this)">${this.isUnlocked ? 'üîì' : 'üîí'}</span>`;
             tempDiv.insertAdjacentHTML('afterbegin', lockIconHTML);

             tempDiv.querySelectorAll('.subjudul, .list-item').forEach(child => {
                 child.setAttribute('data-editable-child', 'true');
                 if (this.isUnlocked) {
                    child.setAttribute('contenteditable', 'true'); 
                 }
             });
             
             if (prepend) {
                container.prepend(tempDiv);
             } else {
                container.appendChild(tempDiv);
             }
             
             this.ensureBoxActionsExist();
             
             return tempDiv; 
        },


        addBox: function(page) {
            if (!this.isUnlocked) {
                 this.showModal();
                 return; 
            }

            const container = document.getElementById(`boxes-${page}`);
            if (!container) return;

            const key = `${page}-box-${Date.now()}`;
            const initialContent = `
                <div class="subjudul" data-editable-child="true">Subjudul Baru</div>
                <ul>
                    <li class="list-item" data-editable-child="true">Item 1</li>
                    <li class="list-item" data-editable-child="true">Item 2</li>
                </ul>
            `;
            
            const newBox = this.renderSingleBox(container, key, initialContent, true);

            const boxes = JSON.parse(localStorage.getItem(`${page}-boxes`) || '[]');
            boxes.push({ key: key, content: initialContent }); 
            localStorage.setItem(`${page}-boxes`, JSON.stringify(boxes));
            
            this.saveBoxContent(key, newBox.innerHTML);
                
            newBox.querySelector('.subjudul')?.focus();
        },
        
        deleteBox: function(button) {
            if (!this.isUnlocked) return this.showModal();
            
            const box = button.closest('.editable-box');
            if (!box) return;
            const key = box.dataset.key;
            
            if (!confirm("Yakin ingin menghapus kotak ini? Aksi ini tidak dapat diurungkan.")) return;

            box.remove();
            
            const pageMatch = key.match(/^(page\d+)-box-/); 
            if (pageMatch) {
                const page = pageMatch[1];
                let boxes = JSON.parse(localStorage.getItem(`${page}-boxes`) || '[]');
                boxes = boxes.filter(b => b.key !== key);
                localStorage.setItem(`${page}-boxes`, JSON.stringify(boxes));
            } else {
                 localStorage.removeItem(key); 
            }
            
            alert("Kotak berhasil dihapus!");
        },

        
        // ========== LOCK/UNLOCK & MODAL ==========
        toggleLock: function(icon) {
            if (!this.isUnlocked) {
                return this.showModal();
            }

            const box = icon.closest('.editable-box');
            if (!box) return;
            
            const editableStatus = !box.classList.contains('locked'); 
            const isDynamicBox = true;

            box.classList.toggle('locked', !editableStatus);
            box.classList.toggle('editable', editableStatus);
            
            box.contentEditable = String(editableStatus && isDynamicBox); 
            
            box.querySelectorAll('[data-editable-child="true"]').forEach(child => {
                if (editableStatus) {
                    child.setAttribute('contenteditable', 'true');
                } else {
                    child.removeAttribute('contenteditable');
                }
            });
            
            icon.textContent = editableStatus ? 'üîì' : 'üîí';
            
            const actionBox = box.querySelector('.box-actions');
            if (actionBox) actionBox.style.opacity = editableStatus ? 1 : 0;
            
            this.saveBoxContent(box.dataset.key, box.innerHTML);
        },

        toggleAllLocks: function() {
            if (this.isUnlocked) {
                this.updateLockState(false);
                alert('Semua konten dikunci!');
            } else {
                this.showModal();
            }
        },

        showModal: function() {
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('pwInput')?.focus();
            }
        },

        closeModal: function() {
            const modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'none';
                const pwInput = document.getElementById('pwInput');
                if (pwInput) pwInput.value = '';
            }
        },

        checkPassword: function() {
            const pwInput = document.getElementById('pwInput');
            if (!pwInput) return;

            const pw = pwInput.value;
            if (pw === this.CORRECT_PASSWORD) {
                this.updateLockState(true);
                this.closeModal();
                alert('Akses edit dibuka!');
            } else {
                alert('Password salah!');
                pwInput.value = '';
                pwInput.focus();
            }
        },


        // ========== VISUAL EFFECTS ==========
        createParticles: function() {
            const particles = document.getElementById('particles');
            if (!particles) return;

            particles.innerHTML = '';

            for (let i = 0; i < 40; i++) { 
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                const size = Math.random() * 3 + 1;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.animationDelay = Math.random() * 20 + 's';
                p.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particles.appendChild(p);
            }
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        app.init();
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && document.getElementById('passwordModal')?.style.display === 'flex') {
            app.checkPassword();
        }
    });
</script>
</body>
</html>